name: BNFGrammar
version: 1.0.0
start: Grammar

# An identifier for node names, properties, etc.
Identifier :: /[a-zA-Z_][a-zA-Z0-9_]*/

# A quoted string literal
String :: /'([^'\\]|\\.)*'/

# A regular expression pattern
Regex :: /\/([^\/\\]|\\.)+\//

# A numeric value
Number :: /\d+(\.\d+)?/

# A comment line starting with #
Comment :: /#[^\n]*/

# Grammar metadata keywords
NameKeyword :: 'name:'
VersionKeyword :: 'version:'
StartKeyword :: 'start:'

# Operators
DefineOperator :: '::'
UnionOperator :: '|'
PropertyOperator :: ':'

# Whitespace
Whitespace :: /[ \t]+/
Newline :: /\r?\n/

# Complete BNF grammar definition
Grammar :: header:Header rules:RuleList

# Grammar header with metadata
Header :: name:NameDeclaration version:VersionDeclaration start:StartDeclaration

# Metadata declarations
NameDeclaration :: NameKeyword value:Identifier Newline
VersionDeclaration :: VersionKeyword value:Identifier Newline  
StartDeclaration :: StartKeyword value:Identifier Newline

# List of grammar rules
RuleList :: rules:Rule

# A single grammar rule definition
Rule :: comment:OptionalComment definition:RuleDefinition Newline

# Optional comment before rule
OptionalComment :: Comment Newline

# Rule name and body definition
RuleDefinition :: name:Identifier DefineOperator body:RuleBody

# Token rule with string or regex pattern
TokenRule :: pattern:TokenPattern

# Deduction rule with sequence of elements
DeductionRule :: sequence:ElementList

# Union rule with alternative choices
UnionRule :: members:UnionMemberList

# Sequence of elements in a deduction rule
ElementList :: elements:Element

# Single element in a sequence
Element :: node:Identifier property:OptionalProperty

# Optional property assignment
OptionalProperty :: PropertyOperator name:Identifier

# List of union members separated by |
UnionMemberList :: first:Identifier rest:AdditionalMembers

# Additional union members
AdditionalMembers :: UnionOperator member:Identifier

# Union types
TokenPattern :: String | Regex
RuleBody :: TokenRule | DeductionRule | UnionRule
